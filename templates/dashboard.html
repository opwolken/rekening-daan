{% extends "base.html" %}
{% block content %}

<div class="card glow-effect">
  <div class="card-body">
    <h1 class="card-title">Mijn BI Dashboard</h1>
    <p>Een overzicht van grafieken en tools uit mijn transacties.</p>
  </div>
</div>

<div class="row">
  <!-- 1. Uren van de dag -->
  <div class="col-md-6 mb-3">
    <div class="card glow-effect">
      <div class="card-body">
        <h2 class="card-title">Uren van de dag</h2>
        <canvas id="urenChart"></canvas>
      </div>
    </div>
  </div>

  <!-- 2. Spaartrend -->
  <div class="col-md-6 mb-3">
    <div class="card glow-effect">
      <div class="card-body">
        <h2 class="card-title">Sparen</h2>
        <canvas id="spaartrendChart"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- 3. Inkomentrend -->
  <div class="col-md-6 mb-3">
    <div class="card glow-effect">
      <div class="card-body">
        <h2 class="card-title">Inkomen</h2>
        <button id="togglePeriod" class="btn btn-secondary mb-3">Toon Jaaroverzicht</button>
        <canvas id="inkomenChart"></canvas>
        <p>Lopende rekening saldo: <span id="lopendeRekeningSaldo"></span></p>
        <p>Spaarrekening saldo: <span id="spaarrekeningSaldo"></span></p>
      </div>
    </div>
  </div>

  <!-- 4. Top 10 Omschrijvingen -->
  <div class="col-md-6 mb-3">
    <div class="card glow-effect">
      <div class="card-body">
        <h2 class="card-title">Top 10 Omschrijvingen</h2>
        <canvas id="top10Chart"></canvas>
      </div>
    </div>
  </div>
</div>

<div class="row">
  <!-- 5. Categorieën per jaar -->
  <div class="col-md-12 mb-3">
    <div class="card glow-effect">
      <div class="card-body">
        <h2 class="card-title">Categorieën per jaar</h2>
        <canvas id="categorieenJaarChart"></canvas>
      </div>
    </div>
  </div>
</div>

<!-- Tools in tabbladen -->
<div class="card glow-effect mb-3">
  <div class="card-body">
    <h2 class="card-title">Tools</h2>
    <ul class="nav nav-tabs" id="toolsTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="specify-tab" data-bs-toggle="tab" data-bs-target="#specify" type="button" role="tab" aria-controls="specify" aria-selected="true">Categorie Specificeren</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="categorize-tab" data-bs-toggle="tab" data-bs-target="#categorize" type="button" role="tab" aria-controls="categorize" aria-selected="false">Categoriseren</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="manage-categories-tab" data-bs-toggle="tab" data-bs-target="#manage-categories" type="button" role="tab" aria-controls="manage-categories" aria-selected="false">Categorieën beheren</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="update-transactions-tab" data-bs-toggle="tab" data-bs-target="#update-transactions" type="button" role="tab" aria-controls="update-transactions" aria-selected="false">Transacties bijwerken</button>
      </li>
    </ul>
    <div class="tab-content" id="toolsTabContent">
      <div class="tab-pane fade show active" id="specify" role="tabpanel" aria-labelledby="specify-tab">
        <!-- Categorie Specificeren -->
        <h3>Categorie Specificeren</h3>
        <form method="GET" action="{{ url_for('index') }}" class="mb-3">
          <label for="category" class="form-label">Selecteer een categorie:</label>
          <select name="category" id="category" class="form-select" onchange="this.form.submit()">
            {% for category in categories %}
            <option value="{{ category }}" {% if category == selected_category %}selected{% endif %}>
              {{ category }}
            </option>
            {% endfor %}
          </select>
        </form>

        {% if rows %}
        <form method="POST" action="{{ url_for('specify') }}">
          <table class="table table-dark table-striped table-bordered">
            <thead>
              <tr>
                <th>Omschrijving</th>
                <th>Nieuwe Subcategorie</th>
              </tr>
            </thead>
            <tbody>
              {% for row in rows %}
              <tr>
                <td>{{ row[0] }}</td>
                <td>
                  <input
                    type="text"
                    class="form-control"
                    name="subcat_{{ row[0] }}"
                    value="{{ row[1] or '' }}"
                    placeholder="{{ row[1] or 'Nieuwe subcategorie...' }}"
                  />
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <button type="submit" class="btn btn-primary">Opslaan</button>
        </form>
        {% else %}
        <p>Geen items gevonden in de geselecteerde categorie.</p>
        {% endif %}
      </div>
      <div class="tab-pane fade" id="categorize" role="tabpanel" aria-labelledby="categorize-tab">
        <!-- Categoriseren -->
        <h3>Categoriseren</h3>
        <form method="POST" action="{{ url_for('categorize') }}">
          <table class="table table-dark table-striped table-bordered">
            <thead>
              <tr>
                <th>Omschrijving</th>
                <th>Bedrag</th>
                <th>Aantal</th>
                <th>Laatse datum</th>
                <th>Nieuwe Categorie</th>
              </tr>
            </thead>
            <tbody>
              {% for row in categorize_rows %}
              <tr>
                <td>{{ row[0] }}</td>
                <td>{{ row[1] }}</td>
                <td>{{ row[2] }}</td>
                <td>{{ row[3] }}</td>
                <td>
                  <input
                    type="text"
                    class="form-control"
                    name="cat_{{ row[0] }}"
                    placeholder="bijv. Boodschappen"
                  />
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <button type="submit" class="btn btn-primary">Opslaan</button>
        </form>
      </div>
      <div class="tab-pane fade" id="manage-categories" role="tabpanel" aria-labelledby="manage-categories-tab">
        <!-- Categorieën beheren -->
        <h3>Categorieën beheren</h3>
        <form method="POST" action="{{ url_for('categories') }}">
          <table class="table table-dark table-striped table-bordered">
            <thead>
              <tr>
                <th>Categorie</th>
                <th>Aantal</th>
                <th>Nieuwe naam</th>
              </tr>
            </thead>
            <tbody>
              {% for category, count in categories %}
              <tr>
                <td>{{ category }}</td>
                <td>{{ count }}</td>
                <td>
                  <input
                    type="text"
                    class="form-control"
                    name="cat_{{ category }}"
                    value="{{ category }}"
                    placeholder="Nieuwe naam"
                  />
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
          <button type="submit" class="btn btn-primary">Opslaan</button>
        </form>
      </div>
      <div class="tab-pane fade" id="update-transactions" role="tabpanel" aria-labelledby="update-transactions-tab">
        <!-- Transacties bijwerken -->
        <h3>Transacties bijwerken</h3>
        <form method="POST" action="{{ url_for('update_transactions') }}">
          <button type="submit" class="btn btn-primary">Nu bijwerken</button>
        </form>
      </div>
    </div>
  </div>
</div>

<!-- Data in JSON-tags -->
<script type="application/json" id="urenLabels">{{ uren_labels|tojson }}</script>
<script type="application/json" id="urenData">{{ uren_data|tojson }}</script>
<script type="application/json" id="spaartrendLabels">{{ spaartrend_labels|tojson }}</script>
<script type="application/json" id="spaartrendData">{{ spaartrend_data|tojson }}</script>
<script type="application/json" id="spaartrendAvgData">{{ spaartrend_avg_data|tojson }}</script>
<script type="application/json" id="inkomenLabels">{{ inkomen_labels|tojson }}</script>
<script type="application/json" id="inkomenDatasets">{{ inkomen_datasets|tojson }}</script>
<script type="application/json" id="inkomenAvgData">{{ inkomen_avg_data|tojson }}</script>
<script type="application/json" id="top10Labels">{{ top10_labels|tojson }}</script>
<script type="application/json" id="top10Data">{{ top10_data|tojson }}</script>
<script type="application/json" id="categorieenJaarLabels">{{ categorieen_jaar_labels|tojson }}</script>
<script type="application/json" id="categorieenJaarDatasets">{{ categorieen_jaar_datasets|tojson }}</script>

<!-- Chart.js en jouw eigen JS-file (dashboard.js) -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
{% endblock %}